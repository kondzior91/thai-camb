<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Panel: Tajlandia – Kambodża (live)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-card: #0b1020;
      --accent: #ffb347;
      --accent-2: #4fd1c5;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --ok: #4ade80;
      --border: #1f2933;
      --font-main: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      font-family: var(--font-main);
      background: radial-gradient(circle at top,#111827 0,#020617 55%,#000 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px;
      display:flex;
      flex-direction:column;
      gap:24px;
    }
    header {
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      gap:16px;
    }
    header h1 { font-size:1.6rem; letter-spacing:0.04em; }
    header span.badge { padding:4px 10px; border-radius:999px; background:rgba(248,113,113,0.12); color:var(--danger); font-size:0.8rem; border:1px solid rgba(248,113,113,0.4); }
    header .meta { font-size:0.8rem; color:var(--text-muted); }
    .layout { display:grid; grid-template-columns:minmax(0,2fr) minmax(0,1.4fr); gap:20px; }
    @media (max-width:900px){ .layout{ grid-template-columns:1fr; } body{ padding:16px; } }
    .card { background:radial-gradient(circle at top left,#111827 0,#020617 60%); border-radius:14px; border:1px solid var(--border); padding:14px 16px; box-shadow:0 18px 40px rgba(0,0,0,0.65); }
    .card h2 { font-size:0.95rem; text-transform:uppercase; letter-spacing:0.12em; color:var(--text-muted); margin-bottom:10px; }
    .grid-3 { display:grid; grid-template-columns:repeat(3,minmax(0,1fr)); gap:10px; }
    @media (max-width:700px){ .grid-3{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    .kpi { padding:10px; border-radius:10px; background:linear-gradient(135deg,rgba(15,23,42,0.95),rgba(15,23,42,0.6)); border:1px solid rgba(148,163,184,0.25); display:flex; flex-direction:column; gap:2px; }
    .kpi-label { font-size:0.7rem; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.09em; }
    .kpi-value { font-size:1.1rem; font-weight:600; }
    .kpi-trend { font-size:0.7rem; color:var(--danger); }
    .status-row { display:flex; align-items:center; justify-content:space-between; margin-top:4px; font-size:0.8rem; color:var(--text-muted); }
    .pill { padding:2px 8px; border-radius:999px; font-size:0.7rem; border:1px solid rgba(148,163,184,0.4); }
    .pill-red { color:var(--danger); border-color:rgba(248,113,113,0.7); }
    .timeline { list-style:none; display:flex; flex-direction:column; gap:10px; margin-top:4px; max-height:260px; overflow-y:auto; padding-right:4px; }
    .event { padding:8px 9px; border-radius:8px; background:rgba(15,23,42,0.85); border:1px solid rgba(31,41,55,0.9); }
    .event-header { display:flex; justify-content:space-between; gap:8px; font-size:0.75rem; color:var(--text-muted); margin-bottom:2px; }
    .event-title { font-size:0.8rem; font-weight:500; color:var(--text-main); margin-bottom:2px; }
    .event-body { font-size:0.78rem; color:var(--text-muted); }
    .two-col { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin-top:6px; font-size:0.8rem; }
    @media (max-width:700px){ .two-col{ grid-template-columns:1fr; } }
    .list { list-style:none; display:flex; flex-direction:column; gap:6px; }
    .list li { display:flex; align-items:flex-start; gap:6px; color:var(--text-muted); }
    .dot { width:6px; height:6px; border-radius:999px; background:var(--accent-2); margin-top:4px; }
    .sources { font-size:0.7rem; color:var(--text-muted); margin-top:6px; }
    .sources a { color:var(--accent-2); text-decoration:none; }
    .sources a:hover { text-decoration:underline; }
    .map-placeholder { margin-top:8px; height:140px; border-radius:10px; border:1px dashed rgba(55,65,81,0.9); display:flex; align-items:center; justify-content:center; font-size:0.8rem; color:var(--text-muted); background:radial-gradient(circle at top,#020617,#000); }
    footer { font-size:0.7rem; color:var(--text-muted); text-align:right; margin-top:4px; }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Panel sytuacyjny: Tajlandia – Kambodża</h1>
      <div class="meta">Status konfliktu: <strong>aktywny konflikt zbrojny</strong> · Dane z NewsData.io</div>
    </div>
    <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px;">
      <span class="badge" id="risk-badge">ŁADOWANIE...</span>
      <span class="meta" id="last-update">Ostatnia aktualizacja: –</span>
    </div>
  </header>
  <main class="layout">
    <section class="card">
      <h2>Kluczowe wskaźniki</h2>
      <div class="grid-3">
        <div class="kpi">
          <div class="kpi-label">Liczba artykułów (24h)</div>
          <div class="kpi-value" id="kpi-total">–</div>
          <div class="kpi-trend">Tajlandia + Kambodża</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Artykuły o granicy</div>
          <div class="kpi-value" id="kpi-border">–</div>
          <div class="kpi-trend">border, clash, conflict</div>
        </div>
        <div class="kpi">
          <div class="kpi-label">Poziom napięcia</div>
          <div class="kpi-value" id="kpi-tension">–</div>
          <div class="kpi-trend">Szacunek: liczba newsów</div>
        </div>
      </div>
      <div class="status-row">
        <span>Ocena ryzyka podróży</span>
        <span class="pill pill-red" id="travel-risk">Ładowanie...</span>
      </div>
      <h2 style="margin-top:16px;">Najnowsze aktualności</h2>
      <ul class="timeline" id="news-list">
        <li class="event"><div class="event-body">Ładowanie newsów...</div></li>
      </ul>
    </section>
    <section class="card">
      <h2>Analiza</h2>
      <div class="two-col">
        <div>
          <strong>Co pokazują newsy</strong>
          <ul class="list" id="insights-left">
            <li><span class="dot"></span><span>Ładowanie danych...</span></li>
          </ul>
        </div>
        <div>
          <strong>Ważne uwagi</strong>
          <ul class="list">
            <li><span class="dot"></span><span>Panel zlicza artykuły z NewsData.io, nie zastępuje oficjalnych ostrzeżeń MSZ.</span></li>
            <li><span class="dot"></span><span>Wysoka liczba newsów może oznaczać eskalację, ale nie pokazuje pełnej skali działań.</span></li>
            <li><span class="dot"></span><span>Przed podróżą sprawdź ostrzeżenia bezpieczeństwa właściwego MSZ.</span></li>
          </ul>
        </div>
      </div>
      <div class="map-placeholder">Mapa do dalszego rozwijania</div>
      <div class="sources">Źródło: <a href="https://newsdata.io" target="_blank">NewsData.io</a></div>
    </section>
  </main>
  <footer>Panel demonstracyjny – dane z API NewsData.io, mogą być niepełne.</footer>
  <script>
    const API_KEY = "pub_5d5318f2676d40f19f0d5ac3348456c1";
    const BASE_URL = "https://newsdata.io/api/1/latest";
    async function fetchCountryNews(countryCode, keywords) {
      const q = encodeURIComponent(keywords.join(" OR "));
      const url = `${BASE_URL}?apikey=${API_KEY}&country=${countryCode}&q=${q}&language=en`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        return data.results || [];
      } catch (e) {
        console.error(`Błąd ${countryCode}:`, e);
        return [];
      }
    }
    function assessTensionScore(totalArticles) {
      if (totalArticles >= 40) return { label: "bardzo wysokie", risk: "NIE PODRÓŻUJ / OMIJAJ" };
      if (totalArticles >= 20) return { label: "wysokie", risk: "STANOWCZO ODRADZANE" };
      if (totalArticles >= 10) return { label: "umiarkowane", risk: "UNIKAJ GRANICY" };
      return { label: "niższe", risk: "ZACHOWAJ OSTROŻNOŚĆ" };
    }
    function formatDate(isoStr) {
      if (!isoStr) return "–";
      const d = new Date(isoStr);
      if (isNaN(d.getTime())) return isoStr;
      return d.toLocaleString("pl-PL", { year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit" });
    }
    function updateKPIs(allArticles) {
      const total = allArticles.length;
      const borderRelated = allArticles.filter(a => {
        const t = (a.title || "").toLowerCase();
        const d = (a.description || "").toLowerCase();
        return t.includes("border") || t.includes("clash") || t.includes("conflict");
      }).length;
      document.getElementById("kpi-total").textContent = total;
      document.getElementById("kpi-border").textContent = borderRelated;
      const { label, risk } = assessTensionScore(borderRelated);
      document.getElementById("kpi-tension").textContent = label.toUpperCase();
      document.getElementById("travel-risk").textContent = risk;
      document.getElementById("risk-badge").textContent = "NAPIĘCIE: " + label.toUpperCase();
    }
    function updateNewsList(allArticles) {
      const container = document.getElementById("news-list");
      container.innerHTML = "";
      const sorted = [...allArticles].sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate)).slice(0, 12);
      if (!sorted.length) {
        const empty = document.createElement("li");
        empty.className = "event";
        empty.innerHTML = '<div class="event-body">Brak nowych artykułów.</div>';
        container.appendChild(empty);
        return;
      }
      for (const art of sorted) {
        const li = document.createElement("li");
        li.className = "event";
        const header = document.createElement("div");
        header.className = "event-header";
        header.innerHTML = `<span>${formatDate(art.pubDate)}</span><span>${art.source_id || "–"}</span>`;
        const title = document.createElement("div");
        title.className = "event-title";
        const link = document.createElement("a");
        link.href = art.link;
        link.target = "_blank";
        link.rel = "noreferrer";
        link.style.color = "inherit";
        link.style.textDecoration = "none";
        link.textContent = art.title || "(brak tytułu)";
        title.appendChild(link);
        const body = document.createElement("div");
        body.className = "event-body";
        body.textContent = art.description ? art.description.slice(0, 180) + "…" : "";
        li.appendChild(header);
        li.appendChild(title);
        li.appendChild(body);
        container.appendChild(li);
      }
    }
    function updateInsights(allArticles) {
      const left = document.getElementById("insights-left");
      left.innerHTML = "";
      const khCount = allArticles.filter(a => (a.country || []).includes("KH")).length;
      const thCount = allArticles.filter(a => (a.country || []).includes("TH")).length;
      const li1 = document.createElement("li");
      li1.innerHTML = '<span class="dot"></span><span>Łącznie ' + allArticles.length
